import{defineComponent as T,ref as y,computed as b,onMounted as k,h as r}from"vue";import{atou as S}from"vuepress-shared/lib/client";import"balloon-css/balloon.css";import"../styles/code-demo.scss";const q='<svg xmlns="http://www.w3.org/2000/svg" class="loading-icon" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"/><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"/></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.3333333333333333s"/><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.3333333333333333s"/></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.6666666666666666s"/><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.6666666666666666s"/></circle></svg>',$='<svg class="codepen-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M123.429 668L468 897.714V692.571L277.143 565.143zM88 585.714L198.286 512 88 438.286v147.428zm468 312L900.571 668 746.857 565.143 556 692.57v205.143zM512 616l155.429-104L512 408 356.571 512zM277.143 458.857L468 331.43V126.286L123.429 356zM825.714 512L936 585.714V438.286zm-78.857-53.143L900.571 356 556 126.286v205.143zM1024 356v312q0 23.429-19.429 36.571l-468 312Q524.571 1024 512 1024t-24.571-7.429l-468-312Q0 691.43 0 668V356q0-23.429 19.429-36.571l468-312Q499.429 0 512 0t24.571 7.429l468 312Q1024 332.57 1024 356z"/></svg>',E='<svg class="jsfiddle-icon" viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"/></svg>',w=CODE_DEMO_OPTIONS,C={html:{types:["html","slim","haml","md","markdown","vue"],map:{html:"none",vue:"none",md:"markdown"}},js:{types:["js","javascript","coffee","coffeescript","ts","typescript","ls","livescript"],map:{js:"none",javascript:"none",coffee:"coffeescript",ls:"livescript",ts:"typescript"}},css:{types:["css","less","sass","scss","stylus","styl"],map:{css:"none",styl:"stylus"}}},N=(e,s,t)=>{const n=document.createElement(e);return s&&Object.keys(s).forEach(l=>{if(l.indexOf("data"))n[l]=s[l];else{const o=l.replace("data","");n.dataset[o]=s[l]}}),t&&t.forEach(l=>{n.appendChild(l)}),n},L=e=>({...w,...e,jsLib:Array.from(new Set([...w.jsLib||[],...e.jsLib||[]])),cssLib:Array.from(new Set([...w.cssLib||[],...e.cssLib||[]]))}),v=(e,s)=>{if(e[s]!==void 0)return e[s];const t=new Promise(n=>{var l;const o=document.createElement("script");o.src=s,(l=document.querySelector("body"))==null||l.appendChild(o),o.onload=()=>{n()}});return e[s]=t,t},O=(e,s)=>{if(s.css&&Array.from(e.childNodes).every(t=>t.nodeName!=="STYLE")){const t=N("style",{innerHTML:s.css});e.appendChild(t)}},A=(e,s,t)=>{const n=t.getScript();if(n&&Array.from(s.childNodes).every(l=>l.nodeName!=="SCRIPT")){const l=document.createElement("script");l.appendChild(document.createTextNode(`{const document=window.document.querySelector('#${e} .code-demo-container').shadowRoot;
${n}}`)),s.appendChild(l)}},D=e=>{const s=Object.keys(e),t={html:[],js:[],css:[],isLegal:!1};return["html","js","css"].forEach(n=>{const l=s.filter(o=>C[n].types.includes(o));if(l.length){const o=l[0];t[n]=[e[o].replace(/^\n|\n$/g,""),C[n].map[o]||o]}}),t.isLegal=(!t.html.length||t.html[1]==="none")&&(!t.js.length||t.js[1]==="none")&&(!t.css.length||t.css[1]==="none"),t},x=e=>e.replace(/<br \/>/g,"<br>").replace(/<((\S+)[^<]*?)\s+\/>/g,"<$1></$2>"),M=e=>`<div id="app">
${x(e)}
</div>`,R=e=>`${e.replace("export default ","const $reactApp = ").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,"")};
ReactDOM.createRoot(document.getElementById("app")).render(React.createElement($reactApp))`,V=e=>e.replace(/export\s+default\s*\{(\n*[\s\S]*)\n*\}\s*;?$/u,"Vue.createApp({$1}).mount('#app')").replace(/export\s+default\s*define(Async)?Component\s*\(\s*\{(\n*[\s\S]*)\n*\}\s*\)\s*;?$/u,"Vue.createApp({$1}).mount('#app')").trim(),_=e=>`(function(exports){var module={};module.exports=exports;${e};return module.exports.__esModule?module.exports.default:module.exports;})({})`,B=(e,s)=>{const t=L(s),n=e.js[0]||"";return{...t,html:x(e.html[0]||""),js:n,css:e.css[0]||"",isLegal:e.isLegal,getScript:()=>{var l;return t.useBabel?((l=window.Babel.transform(n,{presets:["es2015"]}))==null?void 0:l.code)||"":n}}},z=(e,s)=>{const t=L(s),n=e.html[0]||"",l=/<template>([\s\S]+)<\/template>/u.exec(n),o=/<script(\s*lang=(['"])(.*?)\2)?>([\s\S]+)<\/script>/u.exec(n),p=/<style(\s*lang=(['"])(.*?)\2)?\s*(?:scoped)?>([\s\S]+)<\/style>/u.exec(n),d=l?l[1].replace(/^\n|\n$/g,""):"",[i="",a=""]=o?[o[4].replace(/^\n|\n$/g,""),o[3]]:[],[f="",u=""]=p?[p[4].replace(/^\n|\n$/g,""),p[3]]:[],j=a===""&&(u===""||u==="css");return{...t,html:M(d),js:V(i),css:f,isLegal:j,jsLib:[t.vue,...t.jsLib],getScript:()=>{var c,m;const g=s.useBabel?((m=(c=window.Babel)==null?void 0:c.transform(i,{presets:["es2015"]}))==null?void 0:m.code)||"":i.replace(/export\s+default/u,"return");return`const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${_(g)};appOptions.template=\`${d.replace("`",'\\`"')}\`;window.Vue.createApp(appOptions).mount(app);`}}},H=(e,s)=>{const t=L(s);return{...t,html:M(""),js:R(e.js[0]||""),css:e.css[0]||(e.js[0]?e.js[0].replace(/App\.__style__(?:\s*)=(?:\s*)`([\s\S]*)?`/,"$1").trim():""),isLegal:e.isLegal,jsLib:[t.react,t.reactDOM,...t.jsLib],jsx:!0,getScript:()=>{var n,l;const o=((l=(n=window.Babel)==null?void 0:n.transform(e.js[0]||"",{presets:["es2015","react"]}))==null?void 0:l.code)||"";return`window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${_(o)}))`}}},h={},P=e=>Promise.all([v(h,e.babel),v(h,e.react),v(h,e.reactDOM)]),I=e=>{const s=[v(h,e.vue)];return e.useBabel&&s.push(v(h,e.babel)),Promise.all(s)},J=e=>e.useBabel?v(h,e.babel):Promise.resolve();var Q=T({name:"CodeDemo",props:{id:{type:String,required:!0},type:{type:String,default:"normal"},title:{type:String,default:""},config:{type:String,default:""},code:{type:String,required:!0}},setup(e,{slots:s}){const t=y(!1),n=y(),l=y(),o=y("0"),p=y(!1),d=b(()=>JSON.parse(S(e.config)||"{}")),i=b(()=>{const c=JSON.parse(S(e.code));return D(c)}),a=b(()=>e.type==="react"?H(i.value,d.value):e.type==="vue"?z(i.value,d.value):B(i.value,d.value)),f=b(()=>a.value.isLegal),u=(c=!1)=>{const m=n.value.attachShadow({mode:"open"}),g=document.createElement("div");g.classList.add("code-demo-app"),m.appendChild(g),f.value?(c&&(g.innerHTML=a.value.html),O(m,a.value),A(e.id,m,a.value),o.value="0"):o.value="auto",p.value=!0},j=()=>{switch(e.type){case"react":return P(a.value).then(()=>u());case"vue":return I(a.value).then(()=>u());default:return J(a.value).then(()=>u(!0))}};return k(()=>{setTimeout(()=>{j()},MARKDOWN_ENHANCE_DELAY)}),()=>{var c;return r("div",{class:"code-demo-wrapper",id:e.id},[p.value?null:r("div",{class:["loading"],innerHTML:q}),r("div",{class:"code-demo-header"},[a.value.isLegal?r("button",{class:["toggle-button",t.value?"down":"right"],onClick:()=>{o.value=t.value?"0":`${l.value.clientHeight+13.8}px`,t.value=!t.value}}):null,e.title?r("span",{class:"title"},decodeURIComponent(e.title)):null,a.value.isLegal&&a.value.jsfiddle!==!1?r("form",{class:"code-demo-jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[r("input",{type:"hidden",name:"html",value:a.value.html}),r("input",{type:"hidden",name:"js",value:a.value.js}),r("input",{type:"hidden",name:"css",value:a.value.css}),r("input",{type:"hidden",name:"wrap",value:"1"}),r("input",{type:"hidden",name:"panel_js",value:"3"}),r("input",{type:"hidden",name:"resources",value:[...a.value.cssLib,...a.value.jsLib].join(",")}),r("button",{type:"submit",class:"jsfiddle-button",innerHTML:E,"aria-label":"JSFiddle","data-balloon-pos":"up"})]):null,!a.value.isLegal||a.value.codepen!==!1?r("form",{class:"code-demo-codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[r("input",{type:"hidden",name:"data",value:JSON.stringify({html:a.value.html,js:a.value.js,css:a.value.css,js_external:a.value.jsLib.join(";"),css_external:a.value.cssLib.join(";"),layout:a.value.codepenLayout,html_pre_processor:i.value?i.value.html[1]:"none",js_pre_processor:i.value?i.value.js[1]:a.value.jsx?"babel":"none",css_pre_processor:i.value?i.value.css[1]:"none",editors:a.value.codepenEditors})}),r("button",{type:"submit",innerHTML:$,class:"codepen-button","aria-label":"Codepen","data-balloon-pos":"up"})]):null]),r("div",{ref:n,class:"code-demo-container",style:{display:f.value&&p.value?"block":"none"}}),r("div",{class:"code-demo-code-wrapper",style:{height:o.value}},r("div",{ref:l,class:"code-demo-codes"},(c=s.default)==null?void 0:c.call(s)))])}}});export{Q as default};
//# sourceMappingURL=CodeDemo.js.map
