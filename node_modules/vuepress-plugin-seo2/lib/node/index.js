import{fs as b,chalk as J}from"@vuepress/utils";import{Logger as R,isAbsoluteUrl as w,isUrl as y,getAuthor as A,getDate as P,stripTags as F}from"vuepress-shared";import M from"gray-matter";import{isLinkHttp as q,removeEndingSlash as D,removeLeadingSlash as W}from"@vuepress/shared";const p=new R("vuepress-plugin-seo2"),_=(t,e)=>Object.entries(e).map(([a,n])=>({localePath:a,lang:n.lang})).filter(a=>typeof a.lang=="string"&&a.lang!==t),E=({frontmatter:t},{hostname:e},{options:{base:a}})=>{const{banner:n,cover:r}=t;if(n){if(w(n))return $(e,a,n);if(y(n))return n}if(r){if(w(r))return $(e,a,r);if(y(r))return r}return null},T=({content:t},{hostname:e},{options:{base:a}})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(t);return n?n.map(([,r])=>w(r)?$(e,a,r):y(r)?r:null).filter(r=>r!==null):[]},$=(t,e,a)=>`${q(t)?D(t):`https://${D(t)}`}${e}${W(a)}`,z=(t="")=>t.replace(/<\/?.+?\/?>/g,""),K=t=>t?z(M(t).content).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split(`
`).map(e=>e.trim()).join(`
`).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"",j=(t,e,a="",n="")=>{e in t&&(p.error(`"${e}" is removed${n?`, please use ${n} instead.`:" and no longer supported"}${a?`
${a}`:""}`),n||delete t[e])},Q=t=>{j(t,"seo","","ogp"),j(t,"customMeta","","customHead")},V=(t,e,a)=>{var n,r,o;const{isArticle:l=c=>Boolean(c.filePathRelative&&!c.frontmatter.home)}=e,{options:{base:u},siteData:s}=a,{frontmatter:{author:g,time:S,date:m=S,tag:d,tags:f=d},data:{git:h={}}}=t,i=((n=s.locales[t.pathLocale])==null?void 0:n.title)||s.title||((r=s.locales["/"])==null?void 0:r.title)||"",U=g===!1?[]:A(g||e.author),{updatedTime:L}=h,x=L?new Date(L).toISOString():"",B=Array.isArray(f)?f:typeof d=="string"?[d]:[],I=t.title,G=E(t,e,a),H=T(t,e,a),N=_(t.lang,s.locales);let v="";if(m instanceof Date)v=new Date(m).toISOString();else if(m){const c=P(m);c&&c.value&&(v=c.value.toISOString())}const k=G||H[0]||e.fallBackImage||"";return{"og:url":$(e.hostname,u,t.path),"og:site_name":i,"og:title":I,"og:description":t.frontmatter.description||e.autoDescription&&t.frontmatter.summary||"","og:type":l(t)?"article":"website","og:image":k,"og:updated_time":x,"og:locale":t.lang,"og:locale:alternate":N.map(({lang:c})=>c),...e.restrictions?{"og:restrictions:age":e.restrictions}:{},...e.twitterID?{"twitter:creator":e.twitterID}:{},...k?{"twitter:card":"summary_large_image","twitter:image:alt":I}:{},"article:author":(o=U[0])==null?void 0:o.name,"article:tag":B,"article:published_time":v,"article:modified_time":x}},X=(t,e,a)=>{const{isArticle:n=i=>Boolean(i.filePathRelative&&!i.frontmatter.home)}=e,{frontmatter:{author:r,time:o,date:l=o},data:{git:u={}}}=t,s=r===!1?[]:A(r||e.author),{updatedTime:g}=u,S=g?new Date(g).toISOString():"",m=t.title,d=E(t,e,a),f=T(t,e,a);let h="";if(l instanceof Date)h=new Date(l).toISOString();else if(l){const i=P(l);i&&i.value&&(h=i.value.toISOString())}return n(t)?{"@context":"https://schema.org","@type":"NewsArticle",headline:m,image:f.length?f:[d||e.fallBackImage||""],datePublished:h,dateModified:S,author:s.map(i=>({"@type":"Person",...i}))}:null},Y=(t,e)=>typeof e.canonical=="function"?e.canonical(t):typeof e.canonical=="string"?`${D(e.canonical)}${t.path}`:null,Z=(t,{hostname:e},{options:a,siteData:n})=>_(t.lang,n.locales).map(({lang:r,localePath:o})=>({lang:r,path:$(e,a.base,`${o}${t.path.replace(t.pathLocale,"")}`)})),O=(t,{name:e,content:a,attribute:n=["article:","og:"].some(r=>e.startsWith(r))?"property":"name"})=>{a&&t.push(["meta",{[n]:e,content:a}])},tt=(t,e)=>{for(const a in e)switch(a){case"article:tag":e["article:tag"].forEach(n=>O(t,{name:"article:tag",content:n}));break;case"og:locale:alternate":e["og:locale:alternate"].forEach(n=>{n!==e["og:locale"]&&O(t,{name:"og:locale:alternate",content:n})});break;default:e[a]&&O(t,{name:a,content:e[a]})}},et=(t,e)=>{e&&t.push(["script",{type:"application/ld+json"},JSON.stringify(e)])},at=(t,e)=>{e&&t.push(["link",{rel:"canonical",href:e}])},nt=(t,e)=>{e.forEach(({lang:a,path:n})=>{t.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:n}])})},rt=(t,e,a)=>{const n=t.frontmatter.head||[],r=V(t,e,a),o=X(t,e,a),l=e.ogp?e.ogp(r,t,a):r,u=e.jsonLd?e.jsonLd(o,t,a):null,s=Y(t,e),g=Z(t,e,a);tt(n,l),et(n,u),at(n,s),nt(n,g),e.customHead&&e.customHead(n,t,a),t.frontmatter.head=n},ot=async t=>{p.load("Generating robots.txt");const e=t.public("robots.txt");let a=b.existsSync(e)?await b.readFile(e,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(p.error(),p.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await b.writeFile(t.dest("robots.txt"),a,{flag:"w"}),p.succeed())},C=(t,e=!1)=>a=>{e&&Q(t),a.env.isDebug&&p.info(`Options: ${t.toString()}`);const n={name:"vuepress-plugin-seo2"};return t.hostname?{...n,extendsPage:(r,o)=>{r.frontmatter.description||(r.frontmatter.summary=F(r.excerpt)||K(r.content).slice(0,180)||""),rt(r,t,o)},onGenerated:r=>ot(r.dir)}:(p.error(`Option ${J.magenta("hostname")} is required!`),n)};export{C as default,C as seoPlugin};
//# sourceMappingURL=index.js.map
