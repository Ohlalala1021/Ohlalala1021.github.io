"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/utils"),t=require("vuepress-shared"),a=require("gray-matter"),r=require("@vuepress/shared");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(a);const l=new t.Logger("vuepress-plugin-seo2"),i=(e,t)=>Object.entries(t).map((([e,t])=>({localePath:e,lang:t.lang}))).filter((t=>"string"==typeof t.lang&&t.lang!==e)),s=({frontmatter:e},{hostname:a},{options:{base:r}})=>{const{banner:n,cover:o}=e;if(n){if(t.isAbsoluteUrl(n))return g(a,r,n);if(t.isUrl(n))return n}if(o){if(t.isAbsoluteUrl(o))return g(a,r,o);if(t.isUrl(o))return o}return null},c=({content:e},{hostname:a},{options:{base:r}})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(e);return n?n.map((([,e])=>t.isAbsoluteUrl(e)?g(a,r,e):t.isUrl(e)?e:null)).filter((e=>null!==e)):[]},g=(e,t,a)=>`${r.isLinkHttp(e)?r.removeEndingSlash(e):`https://${r.removeEndingSlash(e)}`}${t}${r.removeLeadingSlash(a)}`,p=(e,t,a="",r="")=>{t in e&&(l.error(`"${t}" is removed${r?`, please use ${r} instead.`:" and no longer supported"}${a?`\n${a}`:""}`),r||delete e[t])},u=(e,{name:t,content:a,attribute:r=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{a&&e.push(["meta",{[r]:t,content:a}])},m=(e,a,n)=>{const o=e.frontmatter.head||[],l=((e,a,r)=>{const{isArticle:n=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{options:{base:o},siteData:l}=r,{frontmatter:{author:p,time:u,date:m=u,tag:d,tags:f=d},data:{git:h={}}}=e,$=l.locales[e.pathLocale]?.title||l.title||l.locales["/"]?.title||"",v=!1===p?[]:t.getAuthor(p||a.author),{updatedTime:b}=h,y=b?new Date(b).toISOString():"",S=Array.isArray(f)?f:"string"==typeof d?[d]:[],w=e.title,D=s(e,a,r),x=c(e,a,r),O=i(e.lang,l.locales);let A="";if(m instanceof Date)A=new Date(m).toISOString();else if(m){const e=t.getDate(m);e&&e.value&&(A=e.value.toISOString())}const I=D||x[0]||a.fallBackImage||"";return{"og:url":g(a.hostname,o,e.path),"og:site_name":$,"og:title":w,"og:description":e.frontmatter.description||a.autoDescription&&e.frontmatter.summary||"","og:type":n(e)?"article":"website","og:image":I,"og:updated_time":y,"og:locale":e.lang,"og:locale:alternate":O.map((({lang:e})=>e)),...a.restrictions?{"og:restrictions:age":a.restrictions}:{},...a.twitterID?{"twitter:creator":a.twitterID}:{},...I?{"twitter:card":"summary_large_image","twitter:image:alt":w}:{},"article:author":v[0]?.name,"article:tag":S,"article:published_time":A,"article:modified_time":y}})(e,a,n),p=((e,a,r)=>{const{isArticle:n=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{frontmatter:{author:o,time:l,date:i=l},data:{git:g={}}}=e,p=!1===o?[]:t.getAuthor(o||a.author),{updatedTime:u}=g,m=u?new Date(u).toISOString():"",d=e.title,f=s(e,a,r),h=c(e,a,r);let $="";if(i instanceof Date)$=new Date(i).toISOString();else if(i){const e=t.getDate(i);e&&e.value&&($=e.value.toISOString())}return n(e)?{"@context":"https://schema.org","@type":"NewsArticle",headline:d,image:h.length?h:[f||a.fallBackImage||""],datePublished:$,dateModified:m,author:p.map((e=>({"@type":"Person",...e})))}:null})(e,a,n),m=a.ogp?a.ogp(l,e,n):l,d=a.jsonLd?a.jsonLd(p,e,n):null,f=((e,t)=>"function"==typeof t.canonical?t.canonical(e):"string"==typeof t.canonical?`${r.removeEndingSlash(t.canonical)}${e.path}`:null)(e,a),h=((e,t)=>i(e.lang,t.siteData.locales).map((({lang:t,localePath:a})=>({lang:t,path:`${a}${e.path.replace(e.pathLocale,"")}`}))))(e,n);((e,t)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach((t=>u(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((a=>{a!==t["og:locale"]&&u(e,{name:"og:locale:alternate",content:a})}));break;default:t[a]&&u(e,{name:a,content:t[a]})}})(o,m),((e,t)=>{t&&e.push(["script",{type:"application/ld+json"},JSON.stringify(t)])})(o,d),((e,t)=>{t&&e.push(["link",{rel:"canonical",href:t}])})(o,f),((e,t)=>{t.forEach((({lang:t,path:a})=>{e.push(["link",{rel:"alternate",hreflang:t,href:a}])}))})(o,h),a.customHead&&a.customHead(o,e,n),e.frontmatter.head=o},d=(a,r=!1)=>n=>{r&&(e=>{p(e,"seo","","ogp"),p(e,"customMeta","","customHead")})(a),n.env.isDebug&&l.info(`Options: ${a.toString()}`);const i={name:"vuepress-plugin-seo2"};return a.hostname?{...i,extendsPage:(e,r)=>{var n;e.frontmatter.description||(e.frontmatter.summary=t.stripTags(e.excerpt)||(n=e.content,n?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(o.default(n).content).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||""),m(e,a,r)},onGenerated:t=>(async t=>{l.load("Generating robots.txt");const a=t.public("robots.txt");let r=e.fs.existsSync(a)?await e.fs.readFile(a,{encoding:"utf8"}):"";r&&!r.includes("User-agent")?(l.error(),l.update("robots.txt seems invalid!")):(r+="\nUser-agent:*\nDisallow:\n",await e.fs.writeFile(t.dest("robots.txt"),r,{flag:"w"}),l.succeed())})(t.dir)}:(l.error(`Option ${e.chalk.magenta("hostname")} is required!`),i)};exports.default=d,exports.seoPlugin=d;
//# sourceMappingURL=index.js.map
