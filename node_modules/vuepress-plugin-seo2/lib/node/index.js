import{colors as $,fs as D}from"@vuepress/utils";import{isString as L,isLinkHttp as M,removeEndingSlash as y,removeLeadingSlash as W,isArray as q,isFunction as z}from"@vuepress/shared";import{Logger as K,isAbsoluteUrl as I,isUrl as P,getAuthor as _,getDate as G,stripTags as Q,getPageText as V}from"vuepress-shared/node";const s=new K("vuepress-plugin-seo2"),U=({lang:t,path:e,pathLocale:a},{pages:n,siteData:o})=>Object.entries(o.locales).map(([r,{lang:i}])=>({path:`${r}${e.replace(a,"")}`,lang:i})).filter(r=>L(r.lang)&&r.lang!==t&&n.some(({path:i})=>i===r.path)),j=({frontmatter:t},{options:{base:e}},{hostname:a})=>{const{banner:n,cover:o}=t;if(n){if(I(n))return f(a,e,n);if(P(n))return n}if(o){if(I(o))return f(a,e,o);if(P(o))return o}return null},B=({content:t},{options:{base:e}},{hostname:a})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(t);return n?n.map(([,o])=>I(o)?f(a,e,o):P(o)?o:null).filter(o=>o!==null):[]},f=(t,e,a)=>`${M(t)?y(t):`https://${y(t)}`}${e}${W(a)}`,C=(t,e,a="",n="")=>{e in t&&(s.error(`"${$.magenta(e)}" is ${$.red("removed")}${n?`, please use ${$.magenta(n)} instead.`:" and no longer supported"}${a?`
${a}`:""}`),n||delete t[e])},X=t=>{C(t,"seo","","ogp"),C(t,"customMeta","","customHead")},Y=(t,e,a)=>{var n,o,r,i,l;const{isArticle:c=w=>Boolean(w.filePathRelative&&!w.frontmatter.home),author:g}=e,{options:{base:x},siteData:d}=a,{frontmatter:{author:m,time:O,date:S=O,tag:u,tags:v=u},data:{git:h={}}}=t,p=((n=d.locales[t.pathLocale])==null?void 0:n.title)||d.title||((o=d.locales["/"])==null?void 0:o.title)||"",H=m===!1?[]:_(m||g),b=h.updatedTime?new Date(h.updatedTime).toISOString():null,F=q(v)?v:L(u)?[u]:[],k=t.title,J=j(t,a,e),N=B(t,a,e),R=U(t,a),T=(i=(r=G(S))==null?void 0:r.value)==null?void 0:i.toISOString(),E=J||N[0]||e.fallBackImage||"";return{"og:url":f(e.hostname,x,t.path),"og:site_name":p,"og:title":k,"og:description":t.frontmatter.description||"","og:type":c(t)?"article":"website","og:image":E,"og:locale":t.lang,"og:locale:alternate":R.map(({lang:w})=>w),...b?{"og:updated_time":b}:{},...e.restrictions?{"og:restrictions:age":e.restrictions}:{},...e.twitterID?{"twitter:creator":e.twitterID}:{},...E?{"twitter:card":"summary_large_image","twitter:image:alt":k}:{},"article:author":(l=H[0])==null?void 0:l.name,"article:tag":F,...T?{"article:published_time":T}:{},...b?{"article:modified_time":b}:{}}},Z=(t,e,a)=>{var n,o;const{isArticle:r=p=>Boolean(p.filePathRelative&&!p.frontmatter.home),author:i}=e,{title:l,frontmatter:{author:c,description:g,time:x,date:d=x},data:{git:m={}}}=t,O=c===!1?[]:_(c||i),S=(o=(n=G(d))==null?void 0:n.value)==null?void 0:o.toISOString(),u=m.updatedTime?new Date(m.updatedTime).toISOString():null,v=j(t,a,e),h=B(t,a,e);return r(t)?{"@context":"https://schema.org","@type":"Article",headline:l,image:h.length?h:[v||e.fallBackImage||""],datePublished:S,dateModified:u,author:O.map(p=>({"@type":"Person",...p}))}:{"@context":"https://schema.org","@type":"WebPage",name:l,...g?{description:g}:{}}},tt=(t,e)=>z(e.canonical)?e.canonical(t):L(e.canonical)?`${y(e.canonical)}${t.path}`:null,et=(t,{hostname:e},a)=>U(t,a).map(({lang:n,path:o})=>({lang:n,path:f(e,a.options.base,o)})),A=(t,{name:e,content:a,attribute:n=["article:","og:"].some(o=>e.startsWith(o))?"property":"name"})=>{a&&t.push(["meta",{[n]:e,content:a}])},at=(t,e)=>{for(const a in e)switch(a){case"article:tag":e["article:tag"].forEach(n=>A(t,{name:"article:tag",content:n}));break;case"og:locale:alternate":e["og:locale:alternate"].forEach(n=>{n!==e["og:locale"]&&A(t,{name:"og:locale:alternate",content:n})});break;default:e[a]&&A(t,{name:a,content:e[a]})}},nt=(t,e)=>{t.push(["script",{type:"application/ld+json"},JSON.stringify(e)])},ot=(t,e)=>{e&&t.push(["link",{rel:"canonical",href:e}])},rt=(t,e)=>{e.forEach(({lang:a,path:n})=>{t.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:n}])})},it=(t,e)=>{t.pages.forEach(a=>{const n=a.frontmatter.head||[],o=Y(a,e,t),r=Z(a,e,t),i=e.ogp?e.ogp(o,a,t):o,l=e.jsonLd?e.jsonLd(r,a,t):r,c=tt(a,e),g=et(a,e,t);at(n,i),nt(n,l),ot(n,c),rt(n,g),e.customHead&&e.customHead(n,a,t),a.frontmatter.head=n})},lt=async t=>{s.load("Generating robots.txt");const e=t.public("robots.txt");let a=D.existsSync(e)?await D.readFile(e,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(s.error(),s.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await D.writeFile(t.dest("robots.txt"),a,{flag:"w"}),s.succeed())},st=(t,e=!0)=>{if(!t.frontmatter.description&&e){if(t.data.excerpt)t.frontmatter.description=Q(t.data.excerpt).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim();else{const a=V(t);t.frontmatter.description=a.length>180?`${a.slice(0,177)}...`:a}t.data.autoDesc=!0}},ct=(t,e=!1)=>a=>{e&&X(t),a.env.isDebug&&s.info("Options:",t);const n={name:"vuepress-plugin-seo2"};return t.hostname?{...n,extendsPage:o=>{st(o,t.autoDescription!==!1)},onInitialized:o=>{it(o,t)},onGenerated:o=>lt(o.dir)}:(s.error(`Option ${$.magenta("hostname")} is required!`),n)};export{ct as seoPlugin};
//# sourceMappingURL=index.js.map
