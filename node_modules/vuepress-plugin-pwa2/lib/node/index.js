import{useSassPalettePlugin as y}from"vuepress-plugin-sass-palette";import{Logger as z,getRootLang as S,getLocales as j,addViteOptimizeDepsInclude as C,addViteSsrNoExternal as x,useCustomDevServer as P}from"vuepress-shared";import{fs as h,chalk as g,path as f,getDirname as T}from"@vuepress/utils";import{generateSW as O}from"workbox-build";import{ensureEndingSlash as $}from"@vuepress/shared";const m=new z("vuepress-plugin-pwa2"),v=({options:e,deprecatedOption:a,newOption:n,msg:i="",scope:o=""})=>{if(a in e){if(m.warn(`"${a}" is deprecated${o?` in ${o}`:""}, please use "${n}" instead.${i?`
${i}`:""}`),n.includes(".")){const p=n.split(".");let t=e;p.forEach((s,l)=>{l!==p.length-1?(t[s]=t[s]||{},t=t[s]):t[s]=e[a]})}else e[n]=e[a];delete e[a]}},W=e=>{v({options:e,deprecatedOption:"cacheMaxSize",newOption:"maxSize"}),v({options:e,deprecatedOption:"popupComponent",newOption:"updateComponent"})},A=async(e,a)=>{var n,i,o;const{dir:p,siteData:t}=e,{base:s}=e.options,l=p.source(".vuepress/public/manifest.webmanifest"),r=p.source(".vuepress/public/manifest.json"),c=a.manifest||{},d=JSON.parse(h.existsSync(l)?await h.readFile(l,"utf8"):h.existsSync(r)?await h.readFile(r,"utf8"):"{}");return{name:t.title||((n=t.locales["/"])==null?void 0:n.title)||"Site",short_name:t.title||((i=t.locales["/"])==null?void 0:i.title)||"Site",description:t.description||((o=t.locales["/"])==null?void 0:o.description)||"A site built with vuepress",lang:S(e),start_url:s,scope:s,display:"standalone",theme_color:a.themeColor||"#46bd87",background_color:"#ffffff",orientation:"portrait-primary",prefer_related_applications:!1,...d,...c}},N=async(e,a)=>{m.load("Generating manifest.webmanifest");const{dir:n}=e,i=n.dest("manifest.webmanifest");await h.writeJSON(i,await a,{flag:"w"}),m.succeed(),m.update(`Manifest generated and saved to ${g.cyan(f.relative(process.cwd(),i))}!`)},D=(e,a=1024)=>n=>{const i=[],o=[],p=[".png",".jpg",".jpeg","webp","bmp","gif"];for(const t of n)if(p.some(s=>t.url.endsWith(s))){const s=h.statSync(f.resolve(e,t.url));s.size>a*1024?i.push(`Skipped ${t.url}, as it's ${Math.ceil(s.size/1024)} KB.`):o.push(t)}else o.push(t);return{warnings:i,manifest:o}},B=async(e,a)=>{var n;m.load("Generating service worker");const{dest:i}=e.dir,{title:o,locales:p}=e.siteData,t=i("service-worker.js"),s=f.relative(process.cwd(),i()),l=["**/*.{js,mjs,css,svg,woff,woff2,eot,ttf,otf}"];a.cacheHTML?l.push("**/*.html"):l.push("./index.html","./404.html"),a.cachePic&&l.push("**/*.{png,jpg,jpeg,bmp,gif,webp}"),await O({swDest:t,globDirectory:s,cacheId:o||((n=p["/"])==null?void 0:n.title)||"hope",globPatterns:l,cleanupOutdatedCaches:!0,clientsClaim:!0,maximumFileSizeToCacheInBytes:(a.maxSize||2048)*1024,manifestTransforms:[D(s,a.maxPicSize)],...a.generateSWConfig||{}}).then(({count:r,size:c,warnings:d})=>{m.succeed(),m.info(`Precache ${g.cyan(`${r} files`)}, totaling ${g.cyan(`${(c/1024/1024).toFixed(2)} Mb.`)}.`),d.length&&m.warn(`
${d.map(I=>`  · ${I}`).join(`
`)}`),c>104857600?m.error(`Cache Size is larger than 100MB, so that it can not be registerd on all browsers.
${g.blue("Please consider disable `cacheHTML` and `cachePic`, or set `maxSize` and `maxPicSize` option.\n")}`):c>52428800&&m.warn(`
Cache Size is larger than 50MB, which will not be registerd on Safari.
${g.blue("Please consider disable `cacheHTML` and `cachePic`, or set `maxSize` and `maxPicSize` option.\n")}`)})},u=(e,a)=>a.startsWith("/")?a.replace(/^\//,e):a,H=(e,a)=>(a.icons&&(a.icons=a.icons.map(n=>({...n,src:u(e,n.src)}))),a.shortcuts&&(a.shortcuts=a.shortcuts.map(n=>{var i;return{...n,icons:((i=n.icons)==null?void 0:i.map(o=>({...o,src:u(e,o.src)})))||[],url:u(e,n.url)}})),a.screenshots&&(a.screenshots=a.screenshots.map(n=>({...n,src:u(e,n.src)}))),a),L=(e,a)=>{a.favicon&&(a.favicon=u(e,a.favicon)),a.apple&&(a.apple.icon&&(a.apple.icon=u(e,a.apple.icon)),a.apple.maskIcon&&(a.apple.maskIcon=u(e,a.apple.maskIcon))),a.msTile&&a.msTile.image&&(a.msTile.image=u(e,a.msTile.image)),a.manifest&&(a.manifest=H(e,a.manifest))},M=(e,a="/",n=[])=>{var i;const o=[],p=[];n.forEach(r=>{r[0]==="meta"?o.push(r[1].name):r[0]==="link"&&p.push(r[1].rel)});let t="";const s=(r,c,d={})=>{p.includes(r)||n.push(["link",{rel:r,href:c,...d}])},l=(r,c,d={})=>{o.includes(r)||n.push(["meta",{name:r,content:c,...d}])};if(e.favicon&&s("icon",e.favicon),(i=e.manifest)!=null&&i.icons){const{icons:r}=e.manifest;r.length>0&&(t=r[0].src,e.manifest.icons.map(c=>{c.type?s("icon",c.src,{type:c.type,sizes:c.sizes}):s("icon",c.src,{sizes:c.sizes})}))}return s("manifest",`${a}manifest.webmanifest`,{crossorigin:"use-credentials"}),l("theme-color",e.themeColor||"#46bd87"),typeof e.apple=="object"&&(e.apple.icon||t)?(s("apple-touch-icon",e.apple.icon||t),l("apple-mobile-web-app-capable","yes"),l("apple-mobile-web-app-status-bar-style",e.apple.statusBarColor||"black"),e.apple.maskIcon&&s("mask-icon",e.apple.maskIcon,{color:e.themeColor||"#46bd87"})):e.apple!==!1&&t&&(s("apple-touch-icon",t),l("apple-mobile-web-app-capable","yes"),l("apple-mobile-web-app-status-bar-style","black")),typeof e.msTile=="object"&&(e.msTile.image||t)?(l("msapplication-TileImage",e.msTile.image||t),l("msapplication-TileColor",e.msTile.color||e.themeColor||"#46bd87")):e.msTile!==!1&&t&&(l("msapplication-TileImage",t),l("msapplication-TileColor",e.themeColor||"#46bd87")),l("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),n},w={"/en/":{install:"Install",iOSInstall:"Tap the share button and then 'Add to Homescreen'",cancel:"Cancel",close:"Close",prevImage:"Previous Image",nextImage:"Next Image",desc:"Description",feature:"Key Features",explain:"This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. ",hint:"New content found.",update:"New content is available."},"/zh/":{install:"安装",iOSInstall:"点击分享按钮然后点击“添加到主屏幕”",cancel:"取消",close:"关闭",prevImage:"上一张图片",nextImage:"下一张图片",desc:"详情",feature:"主要特色",explain:"该应用可以安装在你的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和你的操作系统安全地进行交互。",hint:"发现新内容可用",update:"新内容已就绪"},"/zh-tw/":{install:"安裝",iOSInstall:"點擊分享按鈕然後點擊“添加到主畫面”",cancel:"取消",close:"關閉",prevImage:"上一張圖片",nextImage:"下一張圖片",desc:"詳情",feature:"主要特色",explain:"該應用可以安裝在你的 PC 或行動裝置上。這將使該 Web 應用程式外觀和行為與其他應用程式相同。它將在出現在應用程式列表中，並可以固定到主畫面，開始菜單或任務欄。此 Web 應用程式還將能夠與其他應用程式和你的操作系統安全地進行交互。",hint:"發現新内容可用",update:"新内容已就绪"},"/de-at/":{install:"Installieren",iOSInstall:"Drucke den Share-Button und dan 'zu Homescreen hinzufügen'",cancel:"Abbrechen",close:"Schließen",prevImage:"Vorheriges Bild",nextImage:"Nächstes Bild",desc:"Berschreibung",feature:"Features",explain:"Diese App kann auf Ihrem PC oder Mobilgerät installiert werden.  Dadurch sieht diese Web-App aus und verhält sich wie jede andere installierte App.  Sie finden sie in Ihren App-Listen und können sie an den Startbildschirm, die Startmenüs oder die Taskleisten anheften.  Diese installierte Web-App kann auch sicher mit anderen Apps und Ihrem Betriebssystem interagieren.",hint:"Neue Inhalte sind verfügbar.",update:"Neue Inhalte sind verfügbar."},"/vi/":{install:"Tải về",iOSInstall:"Nhấn vào nút chia sẻ và sau đó 'Thêm vào Màn hình chính'",cancel:"Huỷ bỏ",close:"Đóng",prevImage:"Hình ảnh trước đó",nextImage:"Hình ảnh tiếp theo",desc:"Sự miêu tả",feature:"Các tính năng chính",explain:"Ứng dụng này có thể được cài đặt trên PC hoặc thiết bị di động của bạn. Điều này sẽ cho phép ứng dụng web này trông và hoạt động giống như bất kỳ ứng dụng đã cài đặt nào khác. Bạn sẽ tìm thấy nó trong danh sách ứng dụng của mình và có thể ghim nó vào màn hình chính, menu bắt đầu hoặc thanh tác vụ. Ứng dụng web đã cài đặt này cũng sẽ có thể tương tác an toàn với các ứng dụng khác và hệ điều hành của bạn.",hint:"Nội dung mới được tìm thấy",update:"Đã có nội dung mới"},"/uk/":{install:"Встановити",iOSInstall:"Торкніться кнопки «Поділитися», а потім «Додати на головний екран»",cancel:"Скасувати",close:"Закрити",prevImage:"Попереднє зображення",nextImage:"Наступне зображення",desc:"Опис",feature:"Основні характеристики",explain:"Цю програму можна встановити на ПК або мобільний пристрій. Це дозволить цій веб-програмі виглядати та вести себе як будь-яка інша встановлена програма. Ви знайдете її у списках додатків і зможете закріпити на головному екрані, в меню «Пуск» або на панелі завдань. Ця встановлена веб-програма також зможе безпечно взаємодіяти з іншими програмами та вашою операційною системою. ",hint:"Знайдено новий вміст",update:"Доступний новий контент."},"/ru/":{install:"Установить",iOSInstall:"Нажмите кнопку «Поделиться», а затем «Добавить на главный экран»",cancel:"Отменить",close:"Закрыть",prevImage:"Предыдущее изображение",nextImage:"Следующее изображение",desc:"Описание",feature:"Основные функции",explain:"Это приложение может быть установлено на вашем компьютере или мобильном устройстве.  Это позволит веб-приложению выглядеть и вести себя как любое другое установленное приложение.  Вы найдете его в списках приложений и сможете закрепить его на домашнем экране, в меню пуск или на панели задач.  Установленное веб-приложение также сможет безопасно взаимодействовать с другими приложениями и операционной системой. ",hint:"Найден новый контент",update:"Доступен новый контент."},"/br/":{install:"Instalar",iOSInstall:"Toque no botão de compartilhar e depois 'Adicionar à Home'",cancel:"Cancelar",close:"Fechar",prevImage:"Imagem anterior",nextImage:"Próxima imagem",desc:"Descrição",feature:"Características Chave",explain:"Esta aplicação web pode ser instalada no seu PC ou dispositivo móvel. Isso fará com que ela se pareça e se comporte como qualquer outra aplicação.  Você a encontrará na lista de apps e poderá adicionar seu ícone à tela de entrada, menus ou barras de tarefa.  Uma vez instalada, esta aplicação web também poderá interagir com outras aplicações ou com o próprio sistema operacional. ",hint:"Novo conteúdo encontrado",update:"Novo conteúdo está disponível."},"/pl/":{install:"Zainstaluj",iOSInstall:"Stuknij przycisk udostępniania, a następnie „Dodaj do ekranu głównego”",cancel:"Anuluj",close:"Zamknij",prevImage:"Poprzedni obrazek",nextImage:"Następny obrazek",desc:"Opis",feature:"Kluczowe cechy",explain:"Tę aplikację można zainstalować na komputerze lub urządzeniu mobilnym. Dzięki temu ta aplikacja internetowa będzie wyglądać i zachowywać się jak każda inna zainstalowana aplikacja. Znajdziesz ją na listach aplikacji i będziesz mógł przypiąć go do ekranu głównego, menu startowego lub pasków zadań. Ta zainstalowana aplikacja internetowa będzie również mogła bezpiecznie komunikować się z innymi aplikacjami i systemem operacyjnym.",hint:"Znaleziono nową zawartość.",update:"Nowa zawartość jest dostępna."},"/sk/":{install:"Insštalácia",iOSInstall:"Klikni na tlačidlo zdielania a potom 'Daj na domovskú obrazovku'",cancel:"Zrušiť",close:"Zavrieť",prevImage:"Prodošlí obrázok",nextImage:"Ďalší obrázok",desc:"Poznámka",feature:"Kľúčové vlastnosti",explain:"Túto aplikáciu je možné nainštalovať na počítač alebo mobil.  Toto umožný sa správať aplikácii ako každej inej nainštalovanej aplikácii.  Nájdeš ju vo svojom liste aplikácii a budeš môcť ju pripnúť na domovskú stránku, štartovacieho menu alebo do panelu úloh.  Táto nainštalovaná webová aplikácia umžní tiež bezpečne komunikovať s ostatnými nainštalovanými aplikáciami a operačným systémom. ",hint:"Nový obsah bol nájdený.",update:"Nový obsah je dostupný."},"/fr/":{install:"Installer",iOSInstall:"Appuyez sur le bouton partager puis 'Ajouter à l'écran d'accueil'",cancel:"Annuler",close:"Fermer",prevImage:"Image précédente",nextImage:"Image suivante",desc:"Description",feature:"Composants clés",explain:"Cette app peut être installée sur PC ou smartphone.  Cela permettra de rendre cette page web comme n'importe quelle autre application.  Vous la trouverez dans votre liste d'application et serez capable de la pin sur votre écran principal et divers menus.  L'application web installée sera capable d'interagir avec les autres applications et le système d'exploitation.",hint:"New content found.",update:"New content is available."},"/es/":{install:"Instalar",iOSInstall:"Toque el botón compartir y luego 'Agregar a la pantalla de inicio'",cancel:"Cancelar",close:"Cerrar",prevImage:"Imagen anterior",nextImage:"Imagen siguiente",desc:"Descripción",feature:"Características clave",explain:"Esta aplicación se puede instalar en su PC o dispositivo móvil. Esto permitirá que esta aplicación web se vea y se comporte como cualquier otra aplicación instalada. Lo encontrará en su lista de aplicaciones y podrá fijarlo a su pantalla de inicio, menús de inicio o barras de tareas. Esta aplicación web instalada también podrá interactuar de manera segura con otras aplicaciones y su sistema operativo.",hint:"Nuevo contenido encontrado.",update:"Hay nuevo contenido disponible."},"/ja/":{install:"インストール",iOSInstall:"共有ボタンをタップし、「ホームスクリーンに追加」をタップします",cancel:"キャンセル",close:"閉じる",prevImage:"前の画像",nextImage:"次の画像",desc:"詳細",feature:"主な特徴",explain:"このアプリは、PCまたはモバイルデバイスにインストールすることができます。 これにより、このウェブアプリは、インストールされている他のアプリと同様に表示され、動作するようになります。 アプリ一覧で見つけることができ、ホーム画面、スタートメニュー、タスクバーに固定することができます。 このインストールされたウェブアプリケーションは、他のアプリケーションやオペレーティングシステムと安全にやり取りすることもできます。",hint:"新しいコンテンツが見つかりました。",update:"新しいコンテンツが登場しました。"}},E=T(import.meta.url),b=$(f.resolve(E,"../client")),F=(e,a)=>{let n="",i="";return a.showInstall&&(n+=`import PWAInstall from "${b}components/PWAInstall.js";
`,i+=`PWAInstall,
`),a.update==="hint"?(n+=`import SWHintPopup from "${a.hintComponent||`${b}components/SWHintPopup.js`}";
`,i+=`SWHintPopup,
`):a.update!=="disable"&&a.update!=="force"&&(n+=`import SWUpdatePopup from "${a.updateComponent||`${b}components/SWUpdatePopup.js`}";
`,i+=`SWUpdatePopup,
`),e.writeTemp("pwa2/config.js",`import { defineClientConfig } from "@vuepress/client";
import { setupPWA } from "${b}composables/setup.js";
${n}

export default defineClientConfig({
  setup: () => {
    setupPWA();
  },
  rootComponents: [
${i.split(`
`).map(o=>`    ${o}`).join(`
`)}
  ],
});`)},k=(e={},a=!1)=>n=>{a&&W(e),n.env.isDebug&&m.info(`Options: ${e.toString()}`);const{base:i,shouldPrefetch:o=!0}=n.options;e.appendBase&&L(i,e),o===!0&&m.warn('The plugin will register service worker to handle assets, so we recommend you to set "shouldPrefetch: false" in VuePress config file.');const p=A(n,e);return n.options.head=M(e,i,n.options.head),y(n,{id:"hope"}),{name:"vuepress-plugin-pwa2",define:()=>({PWA_LOCALES:j({app:n,name:"pwa",default:w,config:e.locales}),SW_FORCE_UPDATE:e.update==="force",SW_PATH:e.swPath||"service-worker.js"}),extendsBundlerOptions:(t,s)=>{C({app:s,config:t},"register-service-worker"),x({app:s,config:t},["register-service-worker","vuepress-shared"]),P(t,s,"/manifest.webmanifest",async()=>JSON.stringify(await p),"Unexpected manifest generate error")},onGenerated:async t=>{await N(t,p),await B(t,e)},clientConfigFile:t=>F(t,e)}};export{k as default,w as pwaLocales,k as pwaPlugin};
//# sourceMappingURL=index.js.map
